[{"title":"开发技术体系","url":"/dev/","content":"前端\n开发工具 VSCode，开发所需插件：\n\nrest-client\ngithistory\ngitlens\nvscode-css-peek\nvscode-eslint\nvscode-file-peek\nvetur\nvue-beautify\nvue-peek\nvue-snippets\n\n\n前端框架 VueJS2.x，主要包括：\n\n\n\n技术\n说明\n\n\n\nVue\n前端框架核心\n\n\nVue-router\n路由\n\n\nVuex\n全局状态管理\n\n\nAxios\n前端HTTP\n\n\nv-charts\n基于Echarts的图表\n\n\nJs-cookie\ncookie管理工具\n\n\nnprogress\n进度条控件\n\n\nElementUI\n组件库\n\n\n\n代码打包工具 WebPack\n\nEcmaScript 2015\n\n简称ES6，ES2015。是是JavaScript语言的下一代标准。ECMAScript是JavaScript的规格，JavaScript是ECMAScript的一种实现。主流浏览器基本都兼容ES2015，通常开发环境用ES2015，借助Babel将ES2015编译成ES5部署在生产环境。ES2105有很多新特性：let, const, class, extends, super, arrow functions, template string, destructuring, default, rest arguments。\n\n\n前端地图\n\nOpenlayer，目前最新为5.2.0，地图操作有比较全面，目前openlayer整合三维前端框架ol-cesium。目前有适用于Vue的Vuelayers。\nLeaflet，目前最新为1.3.4，轻量级，适合用于移动端。\n\n\n\n后端\n开发工具 IntelliJ IDEA\n\n构建工具 Maven\n\n后端框架 SpringBoot\n\nORM框架 MyBatis\n\n日志 SL4J+logback\n\n缓存 Redis\n\n全文搜索 ElasticSearch\n\n权限控制 Shiro\n\n数据库 Postgres + PostGIS\n\n\n地图服务Geoserver动态读取postgres的地理空间数据，发布切片格式如下\n\n矢量切片\napplication/json;type=geojson，无压缩，不适合大量切片\napplication/vnd.mapbox-vector-tile，有压缩，适合海量切片\n\n\n栅格切片（小比例尺下切片不易成功）\nimage/jpeg\nimage/png\n\n\n\n系统部署\nDocker  \nDocker Swarm 生产环境部署\ndocker-compose 开发测试\n\n\nNginx\n反向代理，包括4层代理和7层代理\n\n\n\n版本控制\nGit\n代码管理 Gogs，代码管理地址\n\n","categories":["dev"],"tags":["stack"]},{"title":"Excel","url":"/excel/","content":"函数Vlookup第一个参数可以包含通配符 *，进行查询。\n\n=VLOOKUP(“*“&amp;B1&amp;”*“,A1:A7,1,)代表的含义是在A1:A7的范围内查找包含B1关键字的单元格，找到后返回A1:A7第一列的内容。函数中的“*”代表任意字符，也就是说在A1:A7内查找B1文本前后任意字符的内容，也就是包含B1文本的意思。其中的1代表返回A1:A7数据区域第一列结果，最后一个逗号后省略参数代表的是精确匹配，也可以输入0或FALSE。\n\n用法函数计算方式\n向量：B2:B6 表示向量。\n数组计算：在公式最外有 {}，快捷键为 ctrl+shift+enter。\n\n数组作为公式参数\n=FIND({“杭州”;”湖州”;”嘉兴 “},B1)，返回结果也是数组，因此显示为#VALUE!\n\n快捷键\n绝对引用切换：选中范围按 F4\n显示公式内容：在单元格上按 F2\n单元格转数组：选中多个单元格按 F9\n公式求值：选中公式按 F9\n多个单元格填充：选中多个单元格按 ctrl+enter\n单元格定位：F5\n快速填充：Ctrl+E\n\n"},{"title":"数据库设计","url":"/db/","content":"数据库设计通常包括：概念设计、逻辑设计和物理设计。\n概念设计概念设计是最顶层设计，包括实体、关系和约束。通常用E-R图表示，分局部E-R图和总E-R图，局部E-R图通常表示管理的一个或几个实体之间的关系及属性，总E-R图通常表示全部实体之间的关系，若实体较多忽略实体属性。若存在几个不相关的实体集，可分开表示，通常该处不表示数据字典。\n\n逻辑设计逻辑设计是概念设计的实施，表示与数据库类型无关的数据结构、数据类型、约束等相关描述。通常选择关系型数据模型，形式为二维表。\n\n物理设计物理设计是与选择数据库类型相关的具体实施，包括创建表结构、索引和约束等，形式为DDL描述的sql脚本。\nCREATE TABLE Customer (  CustNo     NUMBER NOT NULL,  CustName VARCHAR2(200) NOT NULL,  Street       VARCHAR2(200) NOT NULL,  City          VARCHAR2(200) NOT NULL,  State        CHAR(2) NOT NULL,  Zip           VARCHAR2(20) NOT NULL,  PRIMARY KEY (CustNo)  ) ;\n","categories":["dev"],"tags":["db"]},{"title":"git","url":"/git/","content":"生成密钥\nssh-keygen -t rsa -C “username@email.com”\n\n添加本地仓库到github\ngit init\ngit remote add origin git@github.com:bxxfighting/NowToDo.git\ngit branch -u origin/master\ngit pull\n\n忽略已提交文件\n先用如下命令:  git rm -r --cached filename\n再更新.gitignore文件忽略相关文件\n\n创建git使用步骤\n生成ssh key： git bash下运行 ssh-keygen -t rsa -C”username”,然后三个回车，密码为空，上传用户文件夹下的公钥 id_rsa.pub 到服务器\n配置全局用户名 git config –global user.name “hai”、email git config –global user.email “username@email.com“\n配置cr、crlf转换 git config –global core.autocrlf input\n配置safecrlf转换 git config –global core.safecrlf true\n下载代码 git clone git@l.zjchey.com:code/NjqWeb.git\n创建并切换分支 git checkout -b dev\n建立当前本地分支dev和远程dev分支track git branch -u origin/dev\n获取代码 git pull（相当向下箭头），提交代码 git add. git commit -m “message” git push（相当在vcs右键 commit changes）\n\ngit分支\n创建分支 git branch &lt; branch_name &gt;,切换分支 git checkout &lt; branch_name &gt;,创建并切换分支 git checkout -b &lt; branch_name &gt;\n显示本地分支 git branch,显示远程分支 git branch -r,显示本地和远程分支 git branch -a\n获取远程分支 git pull origin &lt; branch_name &gt; 或者 git pull\n推送到远程分支，git push origin &lt; local_branch_name &gt;:&lt; remote_branch_name &gt;,若本地分支和远程分支tracked，可简写为 git push,若 &lt; local_branch_name &gt; 为空，则删除远程分支\n获取远程新分支 git checkout -b &lt; local-branchname &gt; origin/ &lt; remote_branchname&gt;\n删除本地分支 git branch -d &lt; branch_name &gt;,删除远程分支 git branch -d -r orign/&lt; branch_name &gt;\n合并分支 git merge &lt; branch_name &gt;\n建立当前本地分支dev和远程dev分支track git branch -u origin/dev，新建和远程dev分支tracked的本地分支 git branch –track dev origin/dev\n查看本地分支和远程分支是否tracked git branch -vv\n分支重命名 git branch -m oldbranch newbranch\n\ngit撤销\n撤销add git checkout – filefullname\n撤销commit git reset HEAD filefullname\n\ngit reset –mixed：此为默认方式，不带任何参数的git reset，即时这种方式，它回退到某个版本，只保留源码，回退commit和index信息\ngit reset –soft：回退到某个版本，只回退了commit的信息，不会恢复到index file一级。如果还要提交，直接commit即可\ngit reset –hard：彻底回退到某个版本，本地的源码也会变为上一个版本的内容\n\n\n\n\ngit区图解  \ngit其他命令\n创建裸库： git init --bare NjqWeb.git\n查看本地设置 git config –list\nwork和index的比较 git diff，index和repository比较 git diff –staged，work和repository比较 git diff HEAD\ngit status中文被转义 git config –global core.quotePATH false\nmaster分支仅发布不干活，dev分支仅干活不发布\n\ngit多远程仓库[core] repositoryformatversion = 0 filemode = false bare = false logallrefupdates = true symlinks = false ignorecase = true[remote \"origin\"] url = git@l.zjchey.com:haies.github.io url = git@git.oschina.net:haies/blog.git url = git@git.coding.net:haies/blog.git url = git@code.aliyun.com:haies/blog.git fetch = +refs/heads/*:refs/remotes/origin/*[branch \"master\"] remote = origin merge = refs/heads/master\n","categories":["dev"],"tags":["git"]},{"title":"Frontend","url":"/frontend/","content":"EcmaScript 2015\n简称ES6，ES2015。是是JavaScript语言的下一代标准。ECMAScript是JavaScript的规格，JavaScript是ECMAScript的一种实现。主流浏览器基本都兼容ES2015，通常开发环境用ES2015，借助Babel将ES2015编译成ES5部署在生产环境。ES2105有很多新特性：let, const, class, extends, super, arrow functions, template string, destructuring, default, rest arguments。\n\n解构赋值\nThe destructuring assignment syntax is a JavaScript expression that makes it possible to unpack values from arrays, or properties from objects, into distinct variables.\n\n//数组解构赋值let [a, ...b] = [1, 2, 3];console.log(a); // 1console.log(b); // [2, 3]//对象解构赋值let o=&#123;a:1,b:'b1',c:&#123;ci:'cii'&#125;&#125;let &#123;a1,c&#125;=oconsole.log(a1);//undefinedconsole.log(c);//&#123; ci: 'cii' &#125;\n\nimport()函数\nimport函数的参数specifier，指定所要加载的模块的位置。import命令能够接受什么参数，import()函数就能接受什么参数，两者区别主要是后者为动态加载。import()类似于 Node 的require方法，区别主要是前者是异步加载，后者是同步加载。ES6 import()返回一个 Promise 对象。\n\n简洁对象定义//简洁对象定义let a = 'foo', b = 42, c = &#123;&#125;;let o = &#123;a, b, c&#125;;console.log(o);//&#123; a: 'foo', b: 42, c: &#123;&#125; &#125;//简洁函数定义let f=&#123;  fun1()&#123;  &#125;&#125;console.log(f);//&#123; fun1: [Function: fun1] &#125;\n\n对象属性动态定义let lable='lable1'let od=&#123;  [lable]:6378&#125;console.log(od);//&#123; lable1: 6378 &#125;\n\n扩展运算符\nSpread syntax allows an iterable such as an array expression or string to be expanded in places where zero or more arguments (for function calls) or elements (for array literals) are expected, or an object expression to be expanded in places where zero or more key-value pairs (for object literals) are expected. rest 参数的逆运算。\n\nlet to=&#123;'a':'av','b':'bv'&#125;let ta=['1','2','3']console.log([...ta,'4']);//[ '1', '2', '3', '4' ]console.log(&#123;...to,'c':'cv');//es2018 下&#123;'a':'av','b':'bv','c':'cv'&#125;\n地图前端现状OpenlayersOpenlayer目前最新为5.2.0，地图操作有比较全面，目前openlayer整合三维前端框架ol-cesium。目前有适用于Vue的Vuelayers。\nLeafletLeaflet目前最新为1.3.4，轻量级，适合用于移动端。\nVuevue-router静态路由若无redirect选项，刷新后，路由末尾后会自动加斜线，导致后退前进失败，例如\n\n/resource/show会变为/resource/show/\n\n通过addRoutes的动态路由无此问题\nvue-x\nstate：保存数据\ngetters：进行类似map操作，store的computed属性。\nmutations：commit，改变state数据，同步。\nactions：dispatch，业务代码，调用多个mutations，异步。\n\naxioslinqjsfont-awesomeechartsrxlodashmomentIDEA 配置语法高亮\n支持Vue语法高亮：安装vuejs插件\nHTML标签高亮与自动补全：File | Settings | Editor | FileTypes | HTML 添加 *.vue\n\n添加模板File | Settings | Editor | File and Code Templates 添加下面为Vue创建模板：\n&lt;template lang=\"html\"&gt;&lt;/template&gt;&lt;script&gt;    export default &#123;        data() &#123;            return &#123;&#125;        &#125;,        methods: &#123;&#125;,        mounted() &#123;        &#125;,        computed: &#123;&#125;    &#125;&lt;/script&gt;&lt;style lang=\"css\"&gt;&lt;/style&gt;\n\nSCSS语法提示错误\n在IDEA中，style标签中添加 type=&quot;text/scss&quot; 属性\n在VS Code其他等，style标签中添加 rel=&quot;stylesheet/scss&quot; 属性为支持两者，标签如下：\n\n&lt;style rel=\"stylesheet/scss\" lang=\"scss\" type=\"text/scss\"&gt;\n\nWebpack alias支持一般前端开发为适应多种场景，工程根目录不存在webpack.config.json，因此要在File | Settings | Languages &amp; Frameworks | JavaScript | Webpack指定实际的webpack配置文件。\n\n一般不设置webpack.dev.conf.js，设置webpack.base.conf.js，如果仍然显示Module is not installed，重启IDEA即可。\n\n前端问题空子div的高度完全填充父div剩余部分html结构为\n&lt;div id=\"main\"&gt;    &lt;div id=\"nav\"&gt;nav&lt;/div&gt;    &lt;div id=\"content\"&gt;content&lt;/div&gt;&lt;/div&gt;\ncss为：\n/*方法1*/html, body &#123;    height: 100%;    margin: 0px;    padding: 0px;&#125;#main &#123;    background-color: #999;    height: 100%;&#125;#nav &#123;    background-color: #85d989;    width: 100%;    height: 50px;&#125;#content &#123;    background-color: #cc85d9;    width: 100%;    position: absolute;    top: 50px;    bottom: 0px;&#125;/*方法2（省略与上相同部分）*/#content &#123;    background-color: #cc85d9;    width: 100%;    height: calc(100vh -   50px);/*该方法的减号前后必须要有空格*/&#125;/*方法3（省略与上相同部分）*/#nav &#123;    background-color: #85d989;    width: 100%;    height: 50px;    float: left;&#125;#content &#123;    background-color: #cc85d9;    height:100%;&#125;\n","tags":["前端"]},{"title":"epsg","url":"/epsg/","content":"常用坐标对应的EPSG编号cgcs2000_geo: 4490cgcs2000_3_gk_117E: 4548cgcs2000_3_gk_120E: 4549cgcs2000_3_gk_123E: 4550wgs84_geo: 4326web_mercator_auxiliary_sphere: 3875web_mercator(google): 3785\n"},{"title":"docker","url":"/docker/","content":"常用命令\ndocker-compose -f qsh-compose.yml -p qsh up -d\ndocker-compose -f qsh-compose.yml -p qsh down\ndocker exec id /bin/bash|sh\ndocker logs id\nls -lh $(find /var/lib/docker/containers/ -name *-json.log)\ndocker inspect yj_tomcat|grep json.log\ndockerd\n\n日志设置位置/etc/docker/deamon.json\n&#123;  \"log-driver\": \"json-file\",  \"log-opts\": &#123;    \"max-size\": \"1m\",    \"max-file\": \"5\"  &#125;&#125;\n\nservice docker restart\n注意\ncompose文件若引用dockerfile，dockerfile内有相对路径引用的外部文件，则相对路径以compose文件为基础。\n\n"},{"title":"IDEA","url":"/idea/","content":"跳转\n查找对象方法实现类：Ctrl+ Shift+ H\n查看类继承关系：Ctrl + H\n\n设置\nSettings–&gt;Editor–&gt;Code Style–&gt;Line Seperator(Unix)\nSettings–&gt;Editor–&gt;File Encoding–&gt;Properties Files(UTF-8)\n\n","categories":["dev"],"tags":["app"]},{"title":"Java","url":"/java/","content":"获取文件夹指定类型的文件private File[] getFilterFiles(String path, String[] suffix) &#123;    File baseFolder = new File(path);    if(!baseFolder.isDirectory())return null;    FileFilter imageFilter = pathname -&gt; &#123;        String fileName = pathname.getName().toLowerCase();        for (String s : suffix) &#123;            if (fileName.endsWith(s.toLowerCase())) return true;        &#125;        return false;    &#125;;    return baseFolder.listFiles(imageFilter);&#125;\n\n二维表转树Jsonclass itemType;class itemTypeTree extetends itemType&#123;    List&lt;itemTypeTree&gt; children;&#125;private List&lt;ItemTypeTree&gt; recursionNode(List&lt;ItemType&gt; list, ItemType itemTree) &#123;    if(list==null)return null;    if(itemTree==null)itemTree=new ItemTypeTree();    return  getChildNode(list,itemTree).stream()            .map(item -&gt; &#123;                if(getChildNode(list,item).size()&gt;0)&#123;                    item.setChildren(recursionNode(list,item));                &#125;               return  item;            &#125;)            .collect(Collectors.toList());&#125;private List&lt;ItemTypeTree&gt; getChildNode(List&lt;ItemType&gt; list,ItemType itemTree)&#123;    return list.stream()            .filter(item -&gt; &#123;                if(StringUtils.isBlank(itemTree.getTypecode()))&#123;                    return StringUtils.isBlank(item.getParentcode());                &#125;else &#123;                    return item.getParentcode().equals(itemTree.getTypecode());                &#125;            &#125;)            .map(itemType -&gt; &#123;                ItemTypeTree itemTypeTree=new ItemTypeTree();                BeanUtils.copyProperties(itemType,itemTypeTree);                return itemTypeTree;            &#125;)            .collect(Collectors.toList());&#125;\n","categories":["dev"],"tags":["java"]},{"title":"JDK、JRE与JVM的区别","url":"/jvm/","content":"JDK是开发的环境依赖，JRE是程序运行环境依赖，JVM（Java虚拟机）是开发调试运行和程序运行的依赖，三者是套娃结构，JDK包含JRE，JRE包含JVM。\n\nJRE（Java Runtime Environment），提供了一个60M基础类库lib/rt.jar，该库包括常用到的String、集合、网络、多线程等常用类。JRE还提供了不同平台下的JVM。生产环境下的Java程序的运行只需要编译后的字节码+JRE即可。\nJDK（Java Development Kit），比JRE多了一些位于lib文件夹下的开发类库，如dt.jar、tools.jar，JDK同时也提供了位于bin文件夹下的开发工具，如java.exe、javac.exe和jvisualvm.exe。\nJVM（Java Virtual Machine），是一个虚拟的计算机，不同平台有不同的实现方式，比如，Windows平台下是bin/server/jvm.dll，Linux系统下是lib/amd64/server/libjvm.so。\n\nJVMJava虚拟机是实现Java程序跨平台运行的一个抽象层，JVM中的Java解释器负责将字节码文件解释成为特定的机器码进行运行，是实现一次编译处处运行的关键。JVM内存区域分为：类装载器子系统（Class Loader Subsystem）、运行时数据区（ Runtime Data Areas）、和执行引擎（Execution Engine）。JVM内存区域如下：\n\n类加载器子系统，负责加载程序中的类型（类和接口），并赋予唯一的名字。JVM的两种类装载器包括：启动类装载器和用户自定义类装载器，启动类装载器是JVM实现的，自定义类装载器是Java程序中ClassLoader的子类。\n执行引擎，负责执行被加载类中包含的指令，它的执行技术有：解释、即时编译、自适应优化和芯片级直接执行。其中，解释属于第一代JVM，即时编译JIT属于第二代JVM，自适应优化是前两者的结合 ，芯片级直接执行用本地方法执行Java字节码。\n\n\n自适应优化：开始对所有的代码都采取解释执行的方式，并监视代码执行情况，然后对那些经常调用的方法启动一个后台线程，将其编译为本地代码，并进行仔细优化。若方法不再频繁使用，则取消编译过的代码，仍对其进行解释执行，Sun的HotspotJVM采用这种技术。Java与C编译的区别是：Java是运行时链接，而C是编译时链接。\n\n运行时数据区Java程序运行起来后，JVM就是个进程，其运行时数据区是给线程住的内存房子，房子分程序计数器（Program Counter (PC) Register）、虚拟机栈（Java Virtual Machine Stacks）、本地方法栈（Native Method Stacks）、堆（Heap）、方法区（Method Area）、运行时常量池（Run-Time Constant Pool）6个房间，前三个房间是JVM线程私有内存区，后三个是JVM线程共享内存区。方法区包括：变量、静态变量、 类信息(构造方法/接口定义) 和运行时常量池。其他堆内存包括：实例变量和数组。每个线程包含一个栈区，栈中只保存基础数据类型对象和自定义对象的引用(不是对象)。方法区是逻辑独立于堆，但实际包含在堆中，房间结构如下：\n\nJava7之前，方法区位于永久代(PermGen)，永久代和堆相互隔离，永久代的大小在启动JVM时可以设置一个固定值，不可变；Java7中，字符串常量池从永久代移到堆中； Java8中，取消永久代，方法区存放于元空间(Metaspace)，元空间仍然与堆不相连。\n\nJava 堆内存堆房间是给对象住的，堆房间又被分为新生代和老年代两个小房间，新生代小房间又被隔成1个eden隔间和2个survivor隔间，堆房间总大小和各个隔间的比例是JVM调优的关键。JVM进程给Java对象所在的线程提供了运行空间。堆内存结构如下：\n\n参考文献：\n\n什么是JVM？ \n\n字节码执行引擎\n\nThe Structure of the Java Virtual Machine\n\nJVM运行时的数据区\n\njava-memory-management-for-java-virtual-machine-jvm\n\nJava virtual Machine(JVM) and its architecture\n\n\n","tags":["java"]},{"title":"ITIS","url":"/itis/","content":"准备材料清单服务\nZCEY ITISPR-33_服务级别管理程序-服务目录.xls\nZCEY ITISPR-33_服务级别管理程序-IT服务水平协议(SLA).docx\nZCEY ITISPR-33_服务级别管理程序-运营级别协议OLAS.doc\n\n项目\n系统开发合同/开发任务单\n系统需求分析\n系统功能设计\n系统测试方案\n系统测试报告\n系统验收报告或功能点验收报告\n用户报告\n\n运维\nZCEY ITISPR-22_事件管理程序-运维事件汇总记录单.xlsx\nZCEY ITISPR-22_事件管理程序-重大事件处理报告单.docx\n\n其他\n系统变更记录\n系统会议记录\n系统巡检记录\n其他ITIS文件\n\n安全服务协议\n服务目录  服务目录需根据不同的系统进行定制。\n服务协议\n运营协议\n服务提供方式  如果提供技术支持，提供系统支持过程记录单。\n服务评价  用户报告、用户满意度调查\n\n开发过程控制\n系统合同或开发任务书  系类型为：为甲方开发的任务、为院生产开发的任务、出售软件服务。为甲方开发的任务需要提供系统开发合同，后两者需提供开发任务书。\n需求分析  分功能性需求和非功能性需求。\n功能设计  功能设计需以需求为核心，一般包括概要设计和详细设计。\n系统测试  包括系统测试方案，测试报告。\n系统验收  系统验收报告或功能点验收报告。\n系统发布  系统发布方案\n系统运维  提供系统运维记录。\n\n信息安全保证开发环境\n开发环境分内网环境和外网环境，如果开发过程涉及到涉密数据，开发的调试和测试需放在内网环境。\n主机登录需考虑密钥和IP限制。\n主机需进行端口访问和IP访问策略控制，采用阿里云管理访问策略。\n开发主机需要安装杀毒软件或购买相应的云安全服务，如安骑士等。\n\n代码管理\n使用svn 和git进行版本控制，版本控制分成果和开发分支。\n开发人员需提交密钥后才能提交代码，且只能提交到开发分支。\n项目负责人需管理分支，进行code review后将新开发的功能或者改进的代码合并到成果分支。\n\n系统安全\n系统使用需进行登录，和无操作登录超时操作，用户密码需要进行加密和弱密码限制策略。\n系统关键参数，如坐标转换参数需进行加密，且满足一定的加密强度。\n\n数据安全\n系统和系统数据库进行定时和手动备份计划。\n系统代码和文档需在不同主机进行备份。\n系统进行关键数据操作时，提供回退操作，且能回退到操作前的数据状态。\n\n","tags":["summary"]},{"title":"Mybatis","url":"/mybatis/","content":"insert返回主键&lt;insert id=\"insertSelective\" parameterType=\"com.web.quickwork.entity.UserProject\"  useGeneratedKeys=\"true\" keyProperty=\"id\"&gt;&lt;/insert&gt;\n\n&lt;insert id=\"insertSelective\" parameterType=\"com.zjchey.xxfy.geoCity.entity.Report\"&gt;  &lt;selectKey keyProperty=\"uid\" order=\"BEFORE\" resultType=\"java.lang.Object\"&gt;    SELECT uuid_generate_v4()  &lt;/selectKey&gt;&lt;/insert&gt;\n\n&lt;insert id=\"insertSelective\" parameterType=\"com.web.quickwork.entity.UserProject\" &gt;  &lt;selectKey resultType=\"long\" order=\"AFTER\" keyProperty=\"id\"&gt;    SELECT MAX (ID) FROM USERPROJECT  &lt;/selectKey&gt;&lt;/insert&gt;\n","categories":["dev"],"tags":["mybatis"]},{"title":"Gulp","url":"/gulp/","content":"常用插件\nnpm install gulp-autoprefixer gulp-minify-css gulp-jshint gulp-concat gulp-uglify gulp-imagemin gulp-notify gulp-rename gulp-connect gulp-cache del –save-dev\n\n常用命令\ngulp.task(name[, deps], fn) 定义任务  name：任务名称 deps：依赖任务名称 fn：回调函数\ngulp.run(tasks…)：尽可能多的并行运行多个task\ngulp.watch(glob, fn)：当glob内容发生改变时，执行fn\ngulp.src(glob)：置需要处理的文件的路径，可以是多个文件以数组的形式，也可以是正则\ngulp.dest(path[, options])：设置生成文件的路径\n\n","categories":["dev"],"tags":["frontend"]},{"title":"mac","url":"/mac/","content":"hombrewsh -c \"$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)\";sh -c \"$(curl -fsSL https://haies.cn/assets/install-zsh.sh)\";brew install tmux;brew install nmap;brew install wget;brew install ffmpeg;brew install p7zip;brew install iina；brew install obsidian;brew install bilibili;brew install pixpin;brew install stats;brew install iterm2；brew install appcleaner；brew install clash-verge-rev;brew install firefox；brew install google-chrome；brew install microsoft-edge；brew install visual-studio-code;brew install microsoft-remote-desktop;brew tap gromgit/homebrew-fuse；brew install mounty；brew install macfuse;brew install ntfs-3g-mac;brew install node@22;brew unlink node@22 &gt;/dev/null;brew link --overwrite --force node@22;npm i -g hexo-cli;brew install qq；brew install wechat；brew install dingtalkbrew install wpsoffice-cn;brew --cachebrew list nodebrew --prefix nodelaunchctl unload ~/Library/LaunchAgents/文件名.plistrm ~/Library/LaunchAgents/文件名.plistsudo launchctl unload /Library/LaunchDaemons/文件名.plistsudo rm /Library/LaunchDaemons/文件名.plist\n","categories":["utils"],"tags":["os"]},{"title":"Linux","url":"/linux/","content":"初始安装sh -c \"$(wget -qO- https://haies.cn/assets/install-zsh.sh)\"sh -c \"$(wget -qO- https://haies.cn/assets/apt-install.sh)\"sh -c \"$(wget -qO- https://haies.cn/assets/debian-init.sh)\"sh -c \"$(wget -qO- https://haies.cn/assets/centos-init.sh)\"sh -c \"$(wget -qO- https://haies.cn/assets/ubuntu-init.sh)\"sh -c \"$(wget -qO- https://haies.cn/assets/yum-install-docker.sh)\"sh -c \"$(wget -qO- https://haies.cn/assets/dns.sh)\"\n\n压缩  7za a -mx0 -v4g backup.7z /path/to/data7za a -mx0 -v4g backup.7z /path/to/*7za x -mx0 \"backup.7z.001\" -o/path/to/7za a -tzip  backup.zip /path/to/data7za x -tzip  backup.zip /path/to/datatar -cvpf - /path/to/folder | split -d -b 4g - backup.tartar -xvpf backup.tar.00 -C /path/to/target_folder #要求分卷是纯 tar 分割（未压缩），且分卷命名连续cat backup.tar.* | tar -xpv  -C /path/to/foldertar -czvpf - /path/to/folder | split -d -b 4g - backup$(date +%Y%m%d).tar.gzcat backup.tar.gz.* | tar -xzvp  -C /path/to/foldergzip -t backup.tar.gztar -cvpf nginx.tar /etc/nginxtar -xvpf nginx.tar -C /path/to/folderls -l |grep ^d|awk &#123;'print $9'&#125;|xargs -t -i 7z a &#123;&#125;.7z &#123;&#125;\n\n\n7z mx参数  7z 压缩方案  \n\n查看系统信息id -ununame -alsb_release -clscpulshwcat /proc/meminfo\n\n磁盘管理查看磁盘格式：lsblk -f查看磁盘信息：fdisk -l\nmkfs.xfs -f /dev/vdb&amp;&amp;mkdir /hda&amp;&amp;mount /dev/vdb /hda&amp;&amp;echo /dev/vdb    /hda    xfs    defaults    0    0 &gt;&gt; /etc/fstabmkfs.ext4 -T huge -b 4096  /dev/vdb&amp;&amp;mkdir /hda&amp;&amp;mount /dev/vdb /hda&amp;&amp;echo /dev/vdb    /hda    ext4    defaults    0    0 &gt;&gt; /etc/fstabmkfs.ext3 -T largefile -i 4096  /dev/xvdb1&amp;&amp;mkdir /hda&amp;&amp;mount /dev/xvdb1 /hda&amp;&amp;echo /dev/xvdb1    /hda    ext3    defaults    0    0 &gt;&gt; /etc/fstab\n\nparted /dev/sda  resizepart 2pvresize /dev/sdalvextend -l +100%FREE /dev/mapper/centos-homexfs_growfs /dev/mapper/centos-homefdisk /dev/sdbpvcreate /dev/sdb1vgextend ubuntu-vg /dev/sdb1lvextend -L +9G /dev/ubuntu-vg/rootpvsvgslvspvdisplayvgdisplaylvdisplay\n\nNTFS读写apt-get install ntfs-3gmount -t ntfs-3g /dev/hdax /mnt/windows/dev/hdax /mnt/windows ntfs-3g defaults 0 0\n\n目录操作迁移目录：\nmkfs.xfs -f /dev/xvdb2&amp;&amp;mkdir /vartemp&amp;&amp;mount /dev/xvdb2 /vartemp&amp;&amp;rsync -avx /var  /vartemp&amp;&amp;mv /var /var.old&amp;&amp;mkdir /var&amp;&amp;umount -lf /dev/xvdb2 /vartemp&amp;&amp;mount /dev/xvdb2 /var\n\n目录备份还原：dump和restore目录占用查看：fuser和lsof合并文件夹：cp -rlfv parta/* partb/* part  \n配置主机在~/.ssh/config中增加\nInclude ~/.ssh/config.d/*Host aws        Hostname 10.2.*.*        Port 22        User ubuntu        IdentityFile ~/.ssh/aws.pem\n\n远程执行命令ssh root@59.202.*.* \"cd /home/git/.ssh&amp;&amp;cat id_rsq.pub&gt;&gt;authorized_keys\"\n\n挂载DVD源mkdir /iso&amp;&amp;mount -t iso9660 -o loop /hda/debian7.8/debian-7.8.0-amd64-DVD-1.iso /iso&amp;&amp;echo deb file:///iso/ wheezy main contrib&gt;/etc/apt/sources.list&amp;&amp;sudo apt-get update&amp;&amp;sudo apt-get upgrade\n\n增加用户useradd oneuser -d /var/oneuser -G wheel&amp;&amp;usermod -aG root oneuser&amp;&amp;passwd oneuser\n","categories":["utils"],"tags":["os"]},{"title":"ls","url":"/ls/","content":"idea\nCtrl+F12或Alt+7 文件结构\nCtrl+Shift+E 最近更改的文件\nCtrl+Alt+B 跳转到方法实现处\nCtrl+”=/-” 当前方法展开、折叠\nCtrl+Shift+”=/-” 全部展开、折叠\nShift+F8 步出\nAlt+F9 运行至光标处\nAlt+2 收藏\n\nlinux\n查看一级目录大小：du -hd 1\n\ntumx\nta 打开一个窗口\nts 创建一个窗口\ntl 列出窗口\ntkss 杀死一个窗口\ntks 杀死全部\n\nvim\n/search_string\\c 向下查找\n? 向上查找\n:%s/foo/bar/gic 全局范围%查找foo并替换为bar，全局替换g,大小写敏感i，确认 c。\n\nnginx\nnginx -V 查看详细信息（模块）\n\npsql\nsudo -u psql 进入psql\n\\l 列出数据库\n\\dt 列出表\n\\d [tablename] 列出表字段\n\nregex\n部分替换\n\n\n原始字符串：我是程序员正则：(.*)(([^不是]|[^是]|)程序员)(.*)替换为：$1工程师$4\n\n\n非捕捉组\n\n\nWindows(?=95|98|NT|2000)匹配 “Windows2000” 中的 “Windows”不匹配 “Windows3.1” 中的 “Windows”\n\n  模式必须放后面(?=Windows)95无法匹配Windows95。  有回查类型的，例如：\n\n2000(?&lt;=Office|Word|Excel)匹配 “ Office2000” 中的 “2000”不匹配 “Windows2000” 中的 “2000”\n\n  但是回查类型的在Atom和Sublime Text3均无效。\n记不住的\n开启SVN svnserve -d -r /mnt/d/svncode/project\n\n其他\n批量重命名 for i infind -name ‘yale_*’;do mv $i ${i/yale/qsh};done\n批量替换文本内容 sed -i &quot;s/yale/qsh/g&quot; `grep yale -lr .`\n批量替换带空格的文件内容  grep &quot;dc.zjchey.com&quot; -lrZ hldc | xargs -0 sed -i &quot;s/dc.zjchey.com/qsh.haies.cn/g&quot;\ndocker输入宿主文件docker exec -i gogs-mysql mysql -uroot -pxxfY5019  gogs &lt; win/gogs.sql\n\n","tags":["summary"]},{"title":"js","url":"/js/","content":"在封装地图前端API时，一开始在多层次深对象中无法获取类的实例变量，一开始用prototype上的一个属性代替，但是无法满足多个地图实例启动的要求，因为prototype属性是共享的。以下有三种解决方法。\n在运行时绑定function SubRun(input)&#123;  this._input=input;&#125;SubRun.prototype.funs=function()&#123;  const self=this;  return&#123;    show:function()&#123;      // console.log(this._input);      console.log(self._input);    &#125;  &#125;&#125;let subRun=new SubRun(\"sub_run_example\");subRun.funs().show();\n\n通过闭包返回一个函数可获取运行时指向实例的this，但是方法调用时多了一个括号，稍显麻烦。\n使用Applyfunction SubApply(input)&#123;  this._input=input;  SuperApply.apply(this,arguments);&#125;function SuperApply(input)&#123;  const self=this;  this._input=input;  this.base= &#123;    show:function()&#123;      console.log(\"from param: \"+input);      console.log(\"from self: \"+self._input);    &#125;  &#125;;  this.funs=&#123;    show:function()&#123;      console.log(\"from funs:\");      self.base.show();    &#125;  &#125;;&#125;let subApply=new SubApply(\"sub_apply_example\");subApply.base.show();subApply.funs.show();\n\n改方法可解决this对象获取的问题，但是定义多个proto属性需重复写，不优雅。\n使用Classsclass SuperClass&#123;  constructor(input)&#123;    this._input=input;    const self=this;    this.base= &#123;      //使用lambda的方式获取this      show:()=&gt;&#123;        console.log(\"from param: \"+input);        console.log(\"from self: \"+this._input);      &#125;    &#125;;    this.funs=&#123;      show:function()&#123;        console.log(\"from funs lambda:\");        self.base.show();      &#125;    &#125;;  &#125;  get self()&#123;    return this;  &#125;  get protoPropterty()&#123;    // const self=this;    return &#123;      property:()=&gt;&#123;        this.protoMethod();        console.log(this._input);      &#125;    &#125;  &#125;  protoMethod()&#123;    console.log(\"from proto :\"+this._input);  &#125;&#125;class SubClass extends SuperClass&#123;  constructor(input)&#123;    super(input);    this._input=input;    this.ori=&#123;      display:()=&gt;&#123;        console.log(\"from sub call\");        this.funs.show();      &#125;    &#125;  &#125;&#125;let subClass=new SubClass(\"sub_class_example\");let subClass2=new SubClass(\"sub_class_example2\");// subClass.base.show();// subClass.funs.show();subClass.protoPropterty.property();// subClass2.protoPropterty.property();// subClass.protoMethod();// subClass.ori.display();\n\n若有多个原型属性，用const self=this的方法稍显繁琐，利用lambda的特性可在多层次深对象中直接获取指向实例的this。\n"},{"title":"springboot","url":"/springboot/","content":"\n本次项目采用Springboot+Mybatis方式，使用注解式配置，增加全局异常处理，实现前端和后台参数传递过程下划线和驼峰法的自动转换。MyBatis官方没有提供基于Gradle的MyBtis Generator插件，因此沿用Maven做Build工具。\n\n\n配置application.yml关键配置MyBatis配置如下：\nmybatis:  mapper-locations: \"classpath:mapper/*.xml\"  type-aliases-package: \"com.zjchey.dataManage.entity\"  configuration:    map-underscore-to-camel-case: true\n\n\nmap-underscore-to-camel-case: true在生产代码时将数据库中下划线命名自动转为驼峰法命名代码。\n\nJackson配置如下：\njackson:  property-naming-strategy: SNAKE_CASE  defaultPropertyInclusion: NON_EMPTY\n\n\nproperty-naming-strategy: SNAKE_CASE用于前端以application/json方式提交的POST请求的流参数转换，实现前端和后台双向自动下划线和驼峰法命名，后端接受参数的对象需要用@RequestBody修饰。defaultPropertyInclusion: NON_EMPTY用于@ResponseBody修饰的接口在将对象转为json返回参数时，如果对象属性为null，则在json中忽略该属性。\n\n注解配置\n使用@Configuration修饰配置的类。\n使用@Bean修饰的方法相当于xml配置中的bean标签，对应方法名为xml配置中的id属性，也可在用@Bean(name = &quot;heou.net&quot;)的形式指定id。\nSpring的三种装配方式分别是:基于@Component和@Autowired的隐式装配、基于@Configuration的Java显示装配和基于xml配置的显式装配。\n在xml配置中，可通过构造器注入、setter注入的方式装配Bean。\n在运行函数的类的配置如下：\n\n@SpringBootApplication(scanBasePackages = \"com.*.*\")@MapperScan(\"com.*.*.*\")@EnableTransactionManagement\n\n@SpringBootApplication 包括@Configuration、@EnableAutoConfiguration和@ComponentScan三个注解。\n排除tomcat使用undertowMaven:\n&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;    &lt;exclusions&gt;        &lt;exclusion&gt;            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;        &lt;&#x2F;exclusion&gt;    &lt;&#x2F;exclusions&gt;&lt;&#x2F;dependency&gt;\n\nGradle:\nconfigurations &#123;    compile.exclude module: 'spring-boot-starter-tomcat'&#125;或dependencies &#123;    compile('org.springframework.boot:spring-boot-starter-web')&#123;       exclude module: 'spring-boot-starter-tomcat'    &#125;&#125;\n\nlogback日志logging:  file: projectname.log  path: .  pattern: \"%d&#123;HH:mm:ss.SSS&#125; %contextName [%thread] %-5level %logger&#123;36&#125; - %msg%n\"  level:   root: info   org.springframework.web: warn\n\n可指定类的日志输出级别。\nMyBatisMyBatis分页内存分页使用RowBounds\nloggerMapper.getLogsBySortASC(new RowBounds(0,10));\n\nMybatis拦截器待实现\n第三方组件PageHelper\n通用mapper通过泛型实现所有的mapper的CRUD操作，减少代码量。待实现，目前有通用Mapper4\nMyBatis GeneratorPOM配置&lt;plugin&gt;    &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;    &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;    &lt;version&gt;1.3.7&lt;/version&gt;    &lt;configuration&gt;        &lt;overwrite&gt;true&lt;/overwrite&gt;    &lt;/configuration&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;            &lt;version&gt;42.2.5&lt;/version&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;&lt;/plugin&gt;\n\ngeneratorConfig配置&lt;context id=\"context\" targetRuntime=\"MyBatis3\"&gt;&lt;table tableName=\"user\" domainObjectName=\"UserSample\"       enableSelectByPrimaryKey=\"false\" enableUpdateByPrimaryKey=\"false\"       enableDeleteByPrimaryKey=\"false\" delimitIdentifiers=\"true\"/&gt;\n\ntargetRuntime=”MyBatis3”生产的代码包括selectByExample，delimitIdentifiers=”true”确保表名加引号，即使使用关键字（例如user）也可以正常查询。\n常用功能全局异常处理@ControllerAdvicepublic class GlobalExceptionHandler &#123;    private final Logger logger=LoggerFactory.getLogger(getClass());    @ResponseBody    @ExceptionHandler(value = Exception.class)    public Result handlerGlobalException(Exception ex)&#123;        logger.error(ex.getMessage());        return new Result(ex.getMessage(),ResultType.ERROR);    &#125;&#125;\n\n若业务代码中无异常处理，可捕获controller和service中的异常。\n统一返回消息格式1.定义错误代码与错误消息\npublic enum ResultType &#123;    SUCCESS(200,\"接口返回正常\"),    FAILURE(5000,\"接口返回失败\"),    PARAMS_ERROR(5100,\"提交参数错误\"),    PARAMS_ERROR_MISS(5101,\"必填参数缺失\"),    PARAMS_ERROR_INVALID(5102,\"参数无效\"),    PERMISSION_DENIED(6000,\"权限拒绝\"),    DENIED_NOT_ROLE(6100,\"角色权限拒绝\"),    DENIED_NOT_ADMIN(6101,\"非管理员权限\"),    DENIED_NOT_USER(6102,\"用户权限拒绝\"),    ERROR(500,\"接口调用错误\"),    CUSTOM(999,\"定制消息\");    private Integer code;    private String msg;    ResultType(Integer code, String msg)&#123;        this.code=code;        this.msg=msg;    &#125;......&#125;\n\n2.定义返回格式\npublic class Result&lt;T&gt; &#123;    @JsonIgnore    private ResultType resultType;    /*错误码*/    private Integer code;    /*提示信息 */    private String msg;    /*数据内容*/    private T data;    public Result(T data) &#123;        this.data = data;        this.setResultType(null);    &#125;    public Result(T data, ResultType resultType) &#123;        this.data = data;        this.setResultType(resultType);    &#125;......    private void setResultType(ResultType type) &#123;        this.resultType=type==null? ResultType.SUCCESS:type;        this.code= this.resultType.getCode();        this.msg= this.resultType.getMsg();    &#125;&#125;\n\n3.定义BaseController。\n工具类使用Google Guavaapache-commons-collectionsapache-commons-fileupload高级用法数据库读写分离redis二级缓存统一前后端地址使用反向代理\n处理枚举前后端字段下划线和驼峰法自动切换\n指定property-naming-strategy: SNAKE_CASE可实现后台到前端时的lowwer_camel转under_score但是，前端到后台时，后台接受参数的对象前加@RequestBody后，以Content-Type: application/json方式发POST请求时可以实现under_score转lowwer_camel以application/x-www-form-urlencoded发POST请求时可以实现和Get请求均不能实现。\n\n1.通过get请求或者application/x-www-form-urlencoded提交的POST请求\n\n此情况下，参数可通过httpserveletRequest.getParams()获取\n\n定义argumentreslover,如下：\nclass UnderScore2CamelArgumentResolver implements HandlerMethodArgumentResolver&#123;  ....&#125;\n\n2.通过application/json提交的POST请求\n\n此情况下，参数可通过httpserveletRequest.getInputStream()获取参数json流。\n\n参考本文的Jackson配置\n问题Generator的xml文件如何读取application.yml内的内容未解\nyml中的日志名称改为项目名称未解\nInvalid bound statement (not found)异常的全称如下：\n\norg.apache.ibatis.binding.BindingException: Invalid bound statement (not found):\n\n网上大多提到的是xml的mapper无法扫描到，要在启动类配置@MapperScan(“com.*“)，但本项目一开始犯了各低级的错误，application.xml的datasource.url配置成了jdbc:postgres://***，应该是jdbc:postgresql://***\n注解格式化\n@DateTimeFormat(pattern=”yyyy-MM-dd”)是将String转换成Date，一般前台给后台传值时用\n@JsonFormat(pattern=”yyyy-MM-dd”)  将Date转换成String  一般后台传值给前台时\n@JsonDeserialize(using = CustomJsonDateDeserializer.class)\n@JsonSerialize(using= DateJsonSerializer.class)\n\n配置属性\n","tags":["spring"]},{"title":"Postgres","url":"/postgres/","content":"管理命令数据库备份alias pgbackup&#x3D;&#39;thisFun()&#123;pg_dump -U postgres -F t -ovf &#x2F;var&#x2F;pgbak&#x2F;$1_$(date &#39;+%Y%m%d%H%M%S&#39;).tar $1&#125;;thisFun&#39;alias pgbak&#x3D;&#39;pg_dump -h localhost -U postgres -F t -ovf &#x2F;var&#x2F;pgbak&#x2F;njqdb.tar njqdb&#39;pg_dump -h localhost -U postgres -d njqwebdb &gt; &#x2F;hdc&#x2F;njqdbbak&#x2F;njqweb$(date &#39;+%Y%m%d%H%M%S&#39;).bak -v\n\n数据库恢复alias pgrecover&#x3D;&#39;thisFun()&#123;var&#x3D;$&#123;1%%_*&#125;;var&#x3D;$&#123;var##*&#x2F;&#125;;echo $var;pg_restore -U postgres -d $&#123;var&#125; -cv $1&#125;;thisFun&#39;alias pgrec&#x3D;&#39;pg_restore -h localhost -U postgres -d njqdb -cv &#x2F;var&#x2F;pgbak&#x2F;njqdb.tarpsql -h localhost -U postgres -d databasename &lt;  C:\\databasename.bak\n\nLinux管理\n登录数据库 sudo psql -u postgres\n导出到表格\n\nCOPY (SELECT a.corp_name,a.area_code,a.entity_code,b.addr_type,b.addr_content,b.symbol_code,b.geo_addr FROM geo_entity_info as a left join geo_space_info as b on a.corp_id&#x3D;b.corp_id) TO &#39;&#x2F;mnt&#x2F;d&#x2F;a.csv&#39; WITH csv HEADER;\n\n开启模块扩展\n创建数据库\n  create database geoTemplate;\\c geoTemplate;\n\n启用空间数据库模块\n  CREATE EXTENSION postgis;CREATE EXTENSION pgrouting;CREATE EXTENSION postgis_topology;CREATE EXTENSION fuzzystrmatch;CREATE EXTENSION postgis_tiger_geocoder;CREATE EXTENSION address_standardizer;CREATE EXTENSION &quot;uuid-ossp&quot;;\n\n\n\n管理SQL创建空间索引\nCREATE INDEX name ON table USING gist(column);\nCREATE INDEX name ON table USING gin(column);\n\n查询所有数据库大小select pg_database.datname, pg_size_pretty(pg_database_size(pg_database.datname)) AS size from pg_database ORDER BY size DESC\n\n查看全部表大小select relname, pg_size_pretty(pg_relation_size(relid)) from pg_stat_user_tables where schemaname='public' order by pg_relation_size(relid) desc\n\n查看全部表索引大小select indexrelname, pg_size_pretty(pg_relation_size(relid)) from pg_stat_user_indexes where schemaname='public' order by pg_relation_size(relid) desc\n\n查看数据库连接情况select * from pg_stat_activity\n\n结束数据库连接SELECT pg_terminate_backend(pid)  FROM pg_stat_activity WHERE datname='njqwebdb' AND pid&lt;&gt;pg_backend_pid()\n\n查询数据库中的表select * from pg_tables WHERE schemaname='public'\n\n语句耗时统计select * FROM pg_stat_statements ORDER BY total_time DESC\n\n索引缓存命中率SELECT  sum(idx_blks_read) as idx_read,  sum(idx_blks_hit)  as idx_hit,  (sum(idx_blks_hit) - sum(idx_blks_read)) / sum(idx_blks_hit) as ratioFROM  pg_statio_user_indexes;\n\n查看数据库物理大小select pg_size_pretty(pg_database_size('postgres'));\n\n清空带外键约束的表格TRUNCATE njq_user_basic CASCADE \n导入函数创建脚本select proname,  pg_get_functiondef(proname::regproc) from pg_proc where proname LIKE 'njq_%';\n\n日常应用导入数据库shp2pgsql -a -D -s 4326 -W utf-8 point.shp geo_point &gt; result.sql\n\n\n-s 代表指定数据的SRID为3857-c 代表数据将新建一个表-d 删除旧的表，重新建表并插入数据-a 向现有表中追加数据-p 仅创建表结构，不添加数据，这四个参数是互斥的-W Shape文件中属性的字符集，通常Postgresql的字符集是UTF-8，有时候可能Shape数据中的字符集是其他，就可能报“Unable to convert data value to UTF-8 (iconv reports “无效或不完整的多字节字符或宽字符”). Current encoding is “UTF-8”. Try “LATIN1” (Western European)”错误，这时候指定正确的字符集即可解决方问题。\n\n常用查询跨表查询统计SELECT xcz_item.code,xcz_region.\"name\",\"type\",\"count\"(xcz_item.code) AS countFROM xcz_itemLEFT JOIN xcz_regionON xcz_item.code LIKE '330604%' AND xcz_item.code=xcz_region.codeGROUP BY xcz_item.code,\"type\",xcz_region.\"name\"ORDER BY xcz_item.code ,\"type\"\n\n跨表条件统计SELECT DISTINCT a.code,a.name,COALESCE(count(b.*),0) AS total,sum(CASE WHEN b.state = 4 THEN 1 ELSE 0 END) AS finished,sum(CASE WHEN b.state &lt;&gt;4 OR b.state IS NULL THEN 1 ELSE 0 END) AS unfinished,st_astext(st_centroid(a.geom)) AS positionFROM xcz_region a left join xcz_item bON a.code=b.codeWHERE a.need=1 AND b.type='1001'GROUP BY a.code,a.name,a.geomORDER BY a.code\n\n图形操作\n空间查询\n\nSELECT count(*) FROM njq_dk WHERE st_intersects(geom,st_geomfromtext('MULTIPOLYGON(((120.92 29.37,120.93 29.37,120.93 29.38,120.92 29.37,120.92 29.37)))',4326))SELECT count(*) FROM njq_dk WHERE st_intersects(geom,st_geomfromtext('POLYGON((120.92 29.37,120.93 29.37,120.93 29.38,120.92 29.37,120.92 29.37))',4326))\n\n\n创建空间索引\n\ncreate extension pg_trgm;update pg_opclass set opcdefault = true where opcname='gin_trgm_ops';CREATE index on njq_dk USING gist (geom);CREATE index on njq_dk USING gin (geom gin_trgm_ops);\n\n\n外包多边形\n\nselect ST_AsText(ST_ConvexHull(ST_Collect(geom))) FROM xcz_region\n\n\n外包矩形\n\nselect ST_AsText(st_Envelope(ST_Collect(geom))) FROM xcz_region\n\n\n中心点（面质心）\n\nselect st_astext(st_centroid(geom)) FROM xcz_region\n\n\n面上点（和面lable位置一致）\n\nselect st_astext(st_PointOnSurface(geom)) FROM xcz_region\n","categories":["dev"],"tags":["postgres"]},{"title":"Vim","url":"/vim/","content":"跳转&gt;跳转到第一行：**gg**\n跳转到最后一行：**GG**\n跳转到第N行：**Ngg**搜索&gt;向后搜索：**: /**\n向前搜索：**:?**\n下一个：**n**\n上一个：**N**","categories":["dev"],"tags":["vim"]},{"title":"win","url":"/win/","content":"WinGet常用软件winget install --id voidtools.Everything -h;winget install --id VideoLAN.VLC -h;winget install --id 7zip.7zip -h;winget install --id Microsoft.Sysinternals.Suite -h;winget install --id Obsidian.Obsidian -h;winget install --id Google.Chrome -h;winget install --id Mozilla.Firefox -h;winget install --id Tencent.WeChat -h;winget install --id Alibaba.DingTalk -h;winget install --id Evernote.Evernote.CN -h;winget install --id PixPin.PixPin -h;winget install --id Kingsoft.WPSOffice-CN -h;winget install --id Baidu.BaiduNetdisk -h;winget install --id Tencent.QQ -h;winget install --id Tencent.QQMusic -h;winget install --id Tencent.TencentVideo -h;winget install --id Tencent.TencentMeeting -h;winget install --id Bilibili.Bilibili -h;winget install --id QL-Win.QuickLook -h;winget install --id AutoHotkey.AutoHotkey -h;winget install --id Microsoft.PowerToys -h;winget install --id ClashVergeRev.ClashVergeRev -h;winget install --id Microsoft.PowerShell -h;winget install --id Microsoft.VisualStudioCode -i;\n\n一键安装Set-ExecutionPolicy Bypass -Scope Process -Force;irm https://haies.cn/assets/win-install.ps1 | iex;\n\n一键优化Set-ExecutionPolicy Bypass -Scope Process -Force;irm https://debloat.raphi.re/ | iex;\n\n工作软件winget install --id OSGeo.QGIS_LTR -h;winget install --id RealVNC.VNCViewer -h;winget install --id Rufus.Rufus -h;winget install --id WinSCP.WinSCP -h;winget install --id TortoiseSVN.TortoiseSVN -h;winget install --id JurgenRathlev.innounp -h;winget install --id DBBrowserForSQLite.DBBrowserForSQLite -h;winget install --id Canonical.Ubuntu -h;winget install --id PremiumSoft.NavicatPremium -h;winget install --id JetBrains.IntelliJIDEA.Ultimate -h;winget install --id Microsoft.VisualStudio.Community -h;\n\nScoopSet-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser;irm https://get.scoop.sh | iex;\n\nscoop install git-with-openssh gitignore sudo busybox nodejs-lts -gscoop install cmder yarn maven python -g\nnpm  npm i -g  hexo-cli  npm i -g phantomjs-prebuilt  npm i -g vue-cli webpack-cli tldr\n[其他]一键集合irm https://get.activated.win | iex\n\n环境位置\nEverything %AppData%\\Everything\\Everything.ini\nSSH %HOMEPATH%\\.ssh\nGit %HOMEPATH%\\.gitconfig\n\n","categories":["utils"],"tags":["os"]},{"title":"vuejs","url":"/vuejs/","content":"系统环境1.安装node.js\n2.安装cnpm\nnpm i -g cnpm --registry=https://registry.npm.taobao.org\n\n3.安装vue-cli\ncnpm i vue-cli\n\n4.下载代码并进入代码目录下进行模块安装\ncnpm i\n\nIDEA配置\nFile-&gt;settings-&gt;plugins 安装 node 插件和 vue.js 插件，重启IDEA\n配置启动项如下图:\n\n相关知识点\nES6\nvue.js\nvue-router\nvuex\nelement-ui\n\n结构图\n","categories":["dev"],"tags":["vuejs frontend"]},{"title":"UOS下的KVM编译安装","url":"/kvm/","content":"本教程实现在 UOS V20 1070 (内核4.19) 系统上，通过编译安装 QEMU 7.2.21、libvirt 8.0.0 和 virt-manager 5.1.0，实现主机 (Host) UOS 与客户机 (Guest) Windows 10 之间基于 VirtioFS 驱动的高效文件共享。\n选择此版本组合主要是因为：\n\nQEMU 7.2.21 是最后一个完整支持 C语言版本 virtiofsd 的QEMU稳定版。\nlibvirt 8.0.0 是默认会去寻找并使用 C版本 virtiofsd 的最高版本。\n\n系统自带版本的kvm版本老旧，且无法实现基于 VirtioFS 驱动的高效文件共享，编译安装能确保组件间更好的兼容性。教程会涉及升级 Python3、pyenv 和 Meson 以满足编译要求，并统一使用 阿里云镜像 加速下载，安装路径统一为 /usr/local。\n📦 前期准备：环境与依赖首先，我们来配置编译环境和安装基础依赖。\n\n更新系统并安装基础工具 确保系统为最新并安装必要的开发工具：\n sudo apt updatesudo apt upgrade -ysudo apt install -y wget curl git build-essential pkg-config\n\n配置Python环境 (使用阿里云镜像) 鉴于UOS自带Python版本可能较低，我们使用 pyenv 安装新版Python。\n # 安装pyenvgit clone https://gitee.com/mirrors/pyenv.git ~/.pyenvecho 'export PYENV_ROOT=\"$HOME/.pyenv\"' &gt;&gt; ~/.zshrcecho 'export PATH=\"$PYENV_ROOT/bin:$PATH\"' &gt;&gt; ~/.zshrcecho 'eval \"$(pyenv init -)\"' &gt;&gt; ~/.zshrcsource ~/.zshrc# 配置pyenv使用国内镜像加速Python安装echo 'export PYTHON_BUILD_MIRROR_URL=\"https://mirrors.aliyun.com/python/\"' &gt;&gt; ~/.zshrcsource ~/.zshrc# 通过pyenv安装Python 3.8.12 (此版本与QEMU 7.2.21兼容性好)pyenv install 3.8.12pyenv global 3.8.12\n\n升级pip和安装Meson (使用阿里云镜像)\n pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/pip install --upgrade pippip install meson ninja\n\n\n\n🔧 组件编译与安装现在，开始编译和安装三个核心组件。\n1. 编译安装 QEMU 7.2.21QEMU是实际的虚拟机监控器，virtiofsd 也随其发布。\n\n安装QEMU专属依赖\n  sudo apt install -y libglib2.0-dev libpixman-1-dev libcap-ng-dev libseccomp-dev \\libfuse3-dev libattr1-dev libselinux1-dev\n\n编译与安装\n  cd ~wget https://download.qemu.org/qemu-7.2.21.tar.xztar xvf qemu-7.2.21.tar.xzcd qemu-7.2.21./configure --prefix=/usr/local --target-list=x86_64-softmmu \\--enable-kvm --enable-spice --enable-vnc --enable-guest-agent \\--enable-virtfs --enable-virtiofsd --enable-libusb --enable-usb-redir \\--enable-sdl --enable-seccomp --enable-numa --enable-virglrenderer --enable-openglmake -j$(nproc)sudo make install\n\n验证安装\n  qemu-system-x86_64 --version/usr/local/libexec/virtiofsd --version\n\n\n\n2. 编译安装 libvirt 8.0.0libvirt提供了管理虚拟机的API和工具链。\n\n安装libvirt专属依赖\n  sudo apt install -y libxml2-dev libgnutls28-dev libyajl-dev libnl-3-dev \\libnl-route-3-dev libpciaccess-dev libdevmapper-dev libudev-dev libcurl4-gnutls-dev\n\n编译与安装 (使用Meson)\n  cd ~git clone https://gitlab.com/libvirt/libvirt.gitcd libvirtgit checkout v8.0.0meson setup build --prefix=/usr/local -Dsystem=true -Ddriver_qemu=enabled -Ddriver_libvirtd=enabled -Ddriver_remote=enabled -Ddocs=disabledninja -C buildsudo ninja -C build installecho 'export LIBVIRT_DEFAULT_URI=qemu:///system' &gt;&gt; ~/.bashrc\\necho 'export LIBVIRT_DEFAULT_URI=qemu:///system' &gt;&gt; ~/.zshrc\\n\n\n配置并启动libvirt服务\n  sudo systemctl daemon-reloadsudo systemctl enable libvirtdsudo systemctl start libvirtd\n\n\n\n3. 编译安装 virt-manager 5.1.0virt-manager是一个用于管理虚拟机的图形化界面。\n\n安装virt-manager专属依赖\n  sudo apt install -y gir1.2-gtk-3.0 gir1.2-gtksource-3.0 gir1.2-vte-2.91 \\libosinfo-1.0-dev gettext pylint pytest\n\n编译与安装\n  cd ~git clone https://github.com/virt-manager/virt-manager.gitcd virt-managergit checkout v5.1.0meson setup buildmeson install -C build\n\n\n\n⚙️ 配置VirtioFS文件共享组件安装完毕，接下来配置VirtioFS共享。\n\n设置用户权限 将当前用户加入 libvirt 和 kvm 组，以便管理虚拟机而无须root权限：\n sudo usermod -aG libvirt,kvm $USERnewgrp libvirt\n\n准备共享目录 在主机上创建一个准备共享给虚拟机的目录：\n sudo mkdir /mnt/virtiofs_sharesudo chown -R $USER:$USER /mnt/virtiofs_share\n\n配置虚拟机XML (关键步骤) 使用 virsh edit [你的虚拟机名称] 编辑Windows 10虚拟机的配置。\n\n关键点：在 &lt;devices&gt; 部分添加文件系统设备，并必须通过 &lt;binary path=&quot;...&quot;&gt; 显式指定C版 virtiofsd 的路径。这是解决libvirt可能找不到正确 virtiofsd 的关键。\n&lt;domain type='kvm'&gt;  ...   &lt;devices&gt;    ...     &lt;!-- 添加VirtioFS文件系统设备 --&gt;    &lt;filesystem type='mount' accessmode='passthrough'&gt;      &lt;driver type='virtiofs'/&gt;      &lt;!-- 显式指定C版virtiofsd路径 --&gt;      &lt;binary path='/usr/local/libexec/virtiofsd'/&gt;      &lt;source dir='/mnt/virtiofs_share'/&gt;      &lt;target dir='vm_share'/&gt;    &lt;/filesystem&gt;    ...   &lt;/devices&gt;&lt;/domain&gt;\n\n注意*：根据实践，在 qemu.conf 中配置 virtiofsd_path 可能无效，因此直接在虚拟机XML中指定驱动位置是更可靠的方法。\n\n\n\nWindows 10虚拟机驱动安装 要让Windows 10识别VirtioFS共享，需安装驱动。\n\n从 Fedora仓库 下载最新的 virtio-win.iso。\n在virt-manager中，将 virtio-win.iso 挂载到Windows 10虚拟机的CD-ROM。\n在Windows虚拟机中，安装ISO根目录下的 virtio-win-gt-x64.msi，或通过设备管理器为未知设备手动安装 virtio-fs 驱动。\n驱动安装后，在Windows文件资源管理器的地址栏输入 \\\\virtiofs\\vm_share 访问共享目录，或通过”映射网络驱动器”使用此路径。\n\n\n\n💡 故障排除小贴士\n权限问题：确保 /usr/local/libexec/virtiofsd 对 libvirt-qemu 用户可执行，且共享目录有相应权限。\n\nlibvirt服务：修改配置或XML后，记得重启 sudo systemctl restart libvirtd。\n\n驱动问题：确保Windows虚拟机正确安装了 virtio-fs 驱动。\n\n依赖排查与解决\n  ldd $(which qemu-system-x86_64) | grep glibreadelf -d ./build/qemu-system-x86_64 | grep RPATHsudo patchelf --set-rpath \"/opt/glib-2.87/lib/x86_64-linux-gnu:/opt/libgcrypt-1.10/lib\" /usr/local/bin/qemu-system-x86_64./configure LDFLAGS=\"-Wl,-rpath,/opt/glib-2.87/lib/x86_64-linux-gnu:/opt/libgcrypt-1.10/lib\" --target-list=x86_64-softmmu \\\\n    --enable-kvm --enable-spice --enable-vnc --enable-guest-agent \\\\n    --enable-virtfs --enable-libusb --enable-usb-redir \\\\n    --enable-sdl --enable-seccomp --enable-numa --enable-virglrenderer --enable-opengl\n\n","tags":["os,uos,kvm"]},{"title":"uos","url":"/uos/","content":"","tags":["os,uos"]}]